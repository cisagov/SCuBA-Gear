# Purpose: Run unit tests for the code used in workflows

name: Unit Test Workflow

# This is a reusable workflow called by the pipeline.
on:
  workflow_call:
  workflow_dispatch:

permissions: read-all

jobs:
  workflow-tests:
    name: Workflow Unit Tests
    runs-on: windows-latest
    defaults:
      run:
        shell: powershell
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Run Pester Tests
        run: |
          # Source the function
          . utils/workflow/Invoke-PesterTests.ps1
          Invoke-PesterTests -Path 'Testing/workflow'
          # # The -PassThru parameter is what allows the output to be passed to the $result output.
          # # https://pester.dev/docs/commands/Invoke-Pester#-passthru
          # $result = Try {
          #   # Invoke-Pester -Output 'Detailed' -Path 'Testing/workflow/fakedirectory' -PassThru
          #   Invoke-Pester -Output 'Detailed' -Path 'Testing/workflow' -PassThru
          # } Catch {
          #   # This catches errors with the Pester tests.
          #   Write-Warning "An error occurred while running the Pester tests:"
          #   Write-Warning $_
          #   exit 1
          # }
          # # This catches an error that causes Pester not to run at all (e.g.,
          # # if the -Path is set to a nonexistent directory).
          # if ($result -eq $null) {
          #   throw "The Pester tests failed to run."
          # }
